{"ast":null,"code":"import { setBrowserTabId, setBrowserTabState, setInDatabaseByPath } from '../actions/actions';\nimport { getCookieDomain, setCookieTabId } from '../cookiesDispatchers';\nimport { CONSTANTS_KEY } from '../actions/keys';\nimport { request } from \"../../api/request\";\nimport { makeRandomId } from '../helpers';\nimport Cookies from \"js-cookie\";\nexport const ENVIRONMENT = 'ENVIRONMENT';\nexport const CAN_PLAY_AUCTIONS = 'CAN_PLAY_AUCTIONS';\nexport function setCanPlayAuction() {\n  let currentTimeStamp = parseInt(new Date() / 1000);\n  request('/getTime').then(data => {\n    let serverTimeStamp = parseInt(data);\n    let diff = Math.abs(serverTimeStamp - currentTimeStamp);\n    let canPlay = diff <= 1; // saveLog(canPlay);\n\n    Cookies.set(CAN_PLAY_AUCTIONS, canPlay, {\n      expires: 356,\n      domain: getCookieDomain()\n    });\n    setInDatabaseByPath(canPlay, CAN_PLAY_AUCTIONS);\n  });\n}\nexport function getCanPlayAuction() {\n  return Cookies.get(CAN_PLAY_AUCTIONS);\n}\nexport default (store => next => action => {\n  let params = action[ENVIRONMENT];\n\n  if (typeof params === 'undefined') {\n    return next(action);\n  }\n\n  let {\n    action_type\n  } = params;\n  let tabId = makeRandomId(1000);\n  onTabVisibilityChange(() => {\n    let hidden = onTabVisibilityChange();\n    store.dispatch(setBrowserTabState(hidden));\n\n    if (!hidden) {\n      store.dispatch(setCookieTabId(tabId));\n    }\n  });\n  store.dispatch(setCookieTabId(tabId));\n  store.dispatch(setBrowserTabId(tabId));\n  next({\n    type: action_type\n  });\n});","map":{"version":3,"sources":["/home/aziza/reactapp/src/middlewares/environment.js"],"names":["setBrowserTabId","setBrowserTabState","setInDatabaseByPath","getCookieDomain","setCookieTabId","CONSTANTS_KEY","request","makeRandomId","Cookies","ENVIRONMENT","CAN_PLAY_AUCTIONS","setCanPlayAuction","currentTimeStamp","parseInt","Date","then","data","serverTimeStamp","diff","Math","abs","canPlay","set","expires","domain","getCanPlayAuction","get","store","next","action","params","action_type","tabId","onTabVisibilityChange","hidden","dispatch","type"],"mappings":"AAAA,SAAQA,eAAR,EAAyBC,kBAAzB,EAA6CC,mBAA7C,QAAuE,oBAAvE;AACA,SAAQC,eAAR,EAAyBC,cAAzB,QAA8C,uBAA9C;AACA,SAAQC,aAAR,QAA4B,iBAA5B;AACA,SAAQC,OAAR,QAAsB,mBAAtB;AACA,SAAQC,YAAR,QAA2B,YAA3B;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA,OAAO,MAAMC,WAAW,GAAG,aAApB;AAEP,OAAO,MAAMC,iBAAiB,GAAG,mBAA1B;AACP,OAAO,SAASC,iBAAT,GAA6B;AACnC,MAAIC,gBAAgB,GAAGC,QAAQ,CAAC,IAAIC,IAAJ,KAAW,IAAZ,CAA/B;AACAR,EAAAA,OAAO,CAAC,UAAD,CAAP,CAAoBS,IAApB,CAAyBC,IAAI,IAAI;AAChC,QAAIC,eAAe,GAAGJ,QAAQ,CAACG,IAAD,CAA9B;AACA,QAAIE,IAAI,GAAGC,IAAI,CAACC,GAAL,CAASH,eAAe,GAACL,gBAAzB,CAAX;AACA,QAAIS,OAAO,GAAGH,IAAI,IAAI,CAAtB,CAHgC,CAIhC;;AACAV,IAAAA,OAAO,CAACc,GAAR,CAAYZ,iBAAZ,EAA+BW,OAA/B,EAAwC;AAACE,MAAAA,OAAO,EAAE,GAAV;AAAeC,MAAAA,MAAM,EAAErB,eAAe;AAAtC,KAAxC;AACAD,IAAAA,mBAAmB,CAACmB,OAAD,EAAUX,iBAAV,CAAnB;AACA,GAPD;AAQA;AACD,OAAO,SAASe,iBAAT,GAA6B;AACnC,SAAOjB,OAAO,CAACkB,GAAR,CAAYhB,iBAAZ,CAAP;AACA;AACD,gBAAeiB,KAAK,IAAIC,IAAI,IAAIC,MAAM,IAAI;AACzC,MAAIC,MAAM,GAAGD,MAAM,CAACpB,WAAD,CAAnB;;AACA,MAAI,OAAOqB,MAAP,KAAkB,WAAtB,EAAmC;AAClC,WAAOF,IAAI,CAAEC,MAAF,CAAX;AACA;;AACD,MAAI;AACHE,IAAAA;AADG,MAEAD,MAFJ;AAGA,MAAIE,KAAK,GAAGzB,YAAY,CAAC,IAAD,CAAxB;AAEA0B,EAAAA,qBAAqB,CAAC,MAAM;AAC3B,QAAIC,MAAM,GAAGD,qBAAqB,EAAlC;AACAN,IAAAA,KAAK,CAACQ,QAAN,CAAelC,kBAAkB,CAACiC,MAAD,CAAjC;;AACA,QAAI,CAACA,MAAL,EAAa;AACZP,MAAAA,KAAK,CAACQ,QAAN,CAAe/B,cAAc,CAAC4B,KAAD,CAA7B;AACA;AACD,GANoB,CAArB;AAOAL,EAAAA,KAAK,CAACQ,QAAN,CAAe/B,cAAc,CAAC4B,KAAD,CAA7B;AACAL,EAAAA,KAAK,CAACQ,QAAN,CAAenC,eAAe,CAACgC,KAAD,CAA9B;AACAJ,EAAAA,IAAI,CAAC;AACJQ,IAAAA,IAAI,EAAEL;AADF,GAAD,CAAJ;AAGA,CAtBD","sourcesContent":["import {setBrowserTabId, setBrowserTabState, setInDatabaseByPath} from '../actions/actions';\nimport {getCookieDomain, setCookieTabId} from '../cookiesDispatchers';\nimport {CONSTANTS_KEY} from '../actions/keys';\nimport {request} from \"../../api/request\";\nimport {makeRandomId} from '../helpers'\nimport Cookies from \"js-cookie\";\n\nexport const ENVIRONMENT = 'ENVIRONMENT';\n\nexport const CAN_PLAY_AUCTIONS = 'CAN_PLAY_AUCTIONS';\nexport function setCanPlayAuction() {\n\tlet currentTimeStamp = parseInt(new Date()/1000);\n\trequest('/getTime').then(data => {\n\t\tlet serverTimeStamp = parseInt(data);\n\t\tlet diff = Math.abs(serverTimeStamp-currentTimeStamp);\n\t\tlet canPlay = diff <= 1;\n\t\t// saveLog(canPlay);\n\t\tCookies.set(CAN_PLAY_AUCTIONS, canPlay, {expires: 356, domain: getCookieDomain()});\n\t\tsetInDatabaseByPath(canPlay, CAN_PLAY_AUCTIONS);\n\t});\n}\nexport function getCanPlayAuction() {\n\treturn Cookies.get(CAN_PLAY_AUCTIONS);\n}\nexport default store => next => action => {\n\tlet params = action[ENVIRONMENT];\n\tif (typeof params === 'undefined') {\n\t\treturn next( action );\n\t}\n\tlet {\n\t\taction_type,\n\t} = params;\n\tlet tabId = makeRandomId(1000);\n\n\tonTabVisibilityChange(() => {\n\t\tlet hidden = onTabVisibilityChange();\n\t\tstore.dispatch(setBrowserTabState(hidden));\n\t\tif (!hidden) {\n\t\t\tstore.dispatch(setCookieTabId(tabId));\n\t\t}\n\t});\n\tstore.dispatch(setCookieTabId(tabId));\n\tstore.dispatch(setBrowserTabId(tabId));\n\tnext({\n\t\ttype: action_type,\n\t});\n}\n"]},"metadata":{},"sourceType":"module"}