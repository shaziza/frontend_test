{"ast":null,"code":"import { setInDatabaseByPath } from '../actions/actions';\nimport { request } from \"../../api/request\";\nimport { makeRandomId } from '../helpers';\nimport Cookies from \"js-cookie\";\nexport const ENVIRONMENT = 'ENVIRONMENT';\nexport const CAN_PLAY_AUCTIONS = 'CAN_PLAY_AUCTIONS';\nexport function setCanPlayAuction() {\n  let currentTimeStamp = parseInt(new Date() / 1000);\n  request('/getTime').then(data => {\n    let serverTimeStamp = parseInt(data);\n    let diff = Math.abs(serverTimeStamp - currentTimeStamp);\n    let canPlay = diff <= 1; // saveLog(canPlay);\n\n    Cookies.set(CAN_PLAY_AUCTIONS, canPlay, {\n      expires: 356,\n      domain: getCookieDomain()\n    });\n    setInDatabaseByPath(canPlay, CAN_PLAY_AUCTIONS);\n  });\n}\nexport function getCanPlayAuction() {\n  return Cookies.get(CAN_PLAY_AUCTIONS);\n}\nexport default (store => next => action => {\n  let params = action[ENVIRONMENT];\n\n  if (typeof params === 'undefined') {\n    return next(action);\n  }\n\n  let {\n    action_type\n  } = params;\n  let tabId = makeRandomId(1000);\n  onTabVisibilityChange(() => {\n    let hidden = onTabVisibilityChange();\n\n    if (!hidden) {\n      store.dispatch(setCookieTabId(tabId));\n    }\n  });\n  store.dispatch(setCookieTabId(tabId));\n  next({\n    type: action_type\n  });\n});","map":{"version":3,"sources":["/home/aziza/reactapp/src/middlewares/environment.js"],"names":["setInDatabaseByPath","request","makeRandomId","Cookies","ENVIRONMENT","CAN_PLAY_AUCTIONS","setCanPlayAuction","currentTimeStamp","parseInt","Date","then","data","serverTimeStamp","diff","Math","abs","canPlay","set","expires","domain","getCookieDomain","getCanPlayAuction","get","store","next","action","params","action_type","tabId","onTabVisibilityChange","hidden","dispatch","setCookieTabId","type"],"mappings":"AAAA,SAAQA,mBAAR,QAAkC,oBAAlC;AACA,SAAQC,OAAR,QAAsB,mBAAtB;AACA,SAAQC,YAAR,QAA2B,YAA3B;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA,OAAO,MAAMC,WAAW,GAAG,aAApB;AAEP,OAAO,MAAMC,iBAAiB,GAAG,mBAA1B;AACP,OAAO,SAASC,iBAAT,GAA6B;AACnC,MAAIC,gBAAgB,GAAGC,QAAQ,CAAC,IAAIC,IAAJ,KAAW,IAAZ,CAA/B;AACAR,EAAAA,OAAO,CAAC,UAAD,CAAP,CAAoBS,IAApB,CAAyBC,IAAI,IAAI;AAChC,QAAIC,eAAe,GAAGJ,QAAQ,CAACG,IAAD,CAA9B;AACA,QAAIE,IAAI,GAAGC,IAAI,CAACC,GAAL,CAASH,eAAe,GAACL,gBAAzB,CAAX;AACA,QAAIS,OAAO,GAAGH,IAAI,IAAI,CAAtB,CAHgC,CAIhC;;AACAV,IAAAA,OAAO,CAACc,GAAR,CAAYZ,iBAAZ,EAA+BW,OAA/B,EAAwC;AAACE,MAAAA,OAAO,EAAE,GAAV;AAAeC,MAAAA,MAAM,EAAEC,eAAe;AAAtC,KAAxC;AACApB,IAAAA,mBAAmB,CAACgB,OAAD,EAAUX,iBAAV,CAAnB;AACA,GAPD;AAQA;AACD,OAAO,SAASgB,iBAAT,GAA6B;AACnC,SAAOlB,OAAO,CAACmB,GAAR,CAAYjB,iBAAZ,CAAP;AACA;AACD,gBAAekB,KAAK,IAAIC,IAAI,IAAIC,MAAM,IAAI;AACzC,MAAIC,MAAM,GAAGD,MAAM,CAACrB,WAAD,CAAnB;;AACA,MAAI,OAAOsB,MAAP,KAAkB,WAAtB,EAAmC;AAClC,WAAOF,IAAI,CAAEC,MAAF,CAAX;AACA;;AACD,MAAI;AACHE,IAAAA;AADG,MAEAD,MAFJ;AAGA,MAAIE,KAAK,GAAG1B,YAAY,CAAC,IAAD,CAAxB;AAEA2B,EAAAA,qBAAqB,CAAC,MAAM;AAC3B,QAAIC,MAAM,GAAGD,qBAAqB,EAAlC;;AACA,QAAI,CAACC,MAAL,EAAa;AACZP,MAAAA,KAAK,CAACQ,QAAN,CAAeC,cAAc,CAACJ,KAAD,CAA7B;AACA;AACD,GALoB,CAArB;AAMAL,EAAAA,KAAK,CAACQ,QAAN,CAAeC,cAAc,CAACJ,KAAD,CAA7B;AACAJ,EAAAA,IAAI,CAAC;AACJS,IAAAA,IAAI,EAAEN;AADF,GAAD,CAAJ;AAGA,CApBD","sourcesContent":["import {setInDatabaseByPath} from '../actions/actions';\nimport {request} from \"../../api/request\";\nimport {makeRandomId} from '../helpers'\nimport Cookies from \"js-cookie\";\n\nexport const ENVIRONMENT = 'ENVIRONMENT';\n\nexport const CAN_PLAY_AUCTIONS = 'CAN_PLAY_AUCTIONS';\nexport function setCanPlayAuction() {\n\tlet currentTimeStamp = parseInt(new Date()/1000);\n\trequest('/getTime').then(data => {\n\t\tlet serverTimeStamp = parseInt(data);\n\t\tlet diff = Math.abs(serverTimeStamp-currentTimeStamp);\n\t\tlet canPlay = diff <= 1;\n\t\t// saveLog(canPlay);\n\t\tCookies.set(CAN_PLAY_AUCTIONS, canPlay, {expires: 356, domain: getCookieDomain()});\n\t\tsetInDatabaseByPath(canPlay, CAN_PLAY_AUCTIONS);\n\t});\n}\nexport function getCanPlayAuction() {\n\treturn Cookies.get(CAN_PLAY_AUCTIONS);\n}\nexport default store => next => action => {\n\tlet params = action[ENVIRONMENT];\n\tif (typeof params === 'undefined') {\n\t\treturn next( action );\n\t}\n\tlet {\n\t\taction_type,\n\t} = params;\n\tlet tabId = makeRandomId(1000);\n\n\tonTabVisibilityChange(() => {\n\t\tlet hidden = onTabVisibilityChange();\n\t\tif (!hidden) {\n\t\t\tstore.dispatch(setCookieTabId(tabId));\n\t\t}\n\t});\n\tstore.dispatch(setCookieTabId(tabId));\n\tnext({\n\t\ttype: action_type,\n\t});\n}\n"]},"metadata":{},"sourceType":"module"}